<%= erb :header %>
<% user = User.find(params['user_id']) %>
    <p>User details <small><a href="/users">Go to users</a></small></p>
    <div class="table-responsive mb-3">
      <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">First</th>
          <th scope="col">Last</th>
          <th scope="col">Username</th>
          <th scope="col">Twitter Profile</th>
          <th scope="col">Dietary Requirements</th>
          <th scope="col">Address</th>
          <th scope="col">Account Type</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row"><%= user.id %></th>
          <td><%= user.firstname %></td>
          <td><%= user.lastname %></td>
          <td><%= user.username %></td>
          <td><a target="_blank" href="<%= $client.user(user.twitter_id.to_i).uri %>"><%= $client.user(user.twitter_id.to_i).screen_name %></a></td>
          <td>
            <% if(user.user_special_conditions.empty?) %>
            N/A
            <% else %>
              <ul>
                <% user.user_special_conditions.each do |user_special_condition| %>  
                  <li><%= user_special_condition.special_condition.name %></li>
                <% end %>
              </ul>
            <% end %>
          </td>
          <td><%= user.address %></td>
          <td><%= user.account_type.name %></td>
        </tr>
      </tbody>
      </table>
    </div>
    <p>User orders <small><a href="/orders">Go to orders</a></small></p>
    <div class="table-responsive mb-3">
      <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Tweet</th>
          <th scope="col">State</th>
        </tr>
      </thead>
      <tbody>
        <% user.orders.each do |order| %>
          <tr>
            <th scope="row"><a href="/edit-order/<%=order.id%>"><%= order.id %></a></th>
            <% tweet = order.get_tweet %>
            <td><a target="_blank" href="<%= tweet.uri %>"><%= tweet.attrs[:full_text][0...40] %><%= "..." if(tweet.attrs[:full_text].length > 40) %></a></td>
            <td><%= order.order_state.name %></td>
          </tr>
        <% end %>
      </tbody>
      </table>
    </div>
<%= erb :footer %>